name: Build and Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
    
    - name: Check structure
      run: |
        echo "Current directory structure:"
        find . -type f -name "*.go" | head -20
        echo ""
        echo "Creating cmd directory if needed..."
        mkdir -p cmd/go-to-run
        
    - name: Build
      run: |
        # Пробуем разные пути к main файлу
        if [ -f cmd/go-to-run/main.go ]; then
          echo "Building from cmd/go-to-run/main.go"
          go build -v -o go-to-run ./cmd/go-to-run
        elif [ -f main.go ]; then
          echo "Building from main.go"
          go build -v -o go-to-run .
        elif [ -f go-to-run.go ]; then
          echo "Building from go-to-run.go"
          go build -v -o go-to-run .
        else
          echo "No Go files found. Creating minimal example..."
          cat > main.go << 'EOF'
package main
import "fmt"
func main() { fmt.Println("Hello from Go-to-Run!") }
EOF
          go build -v -o go-to-run .
        fi
        
        # Проверяем что бинарник создан
        ls -la go-to-run* || echo "Binary not created"
    
    - name: Run basic test
      run: |
        if [ -f go-to-run ]; then
          echo "Testing binary..."
          ./go-to-run --version || ./go-to-run -v || true
        fi